#!/bin/bash

# ===== COLORS (Catppuccin Mocha) =====
export BASE=0xff1e1e2e
export MANTLE=0xff181825
export CRUST=0xff11111b
export TEXT=0xffcdd6f4
export SUBTEXT=0xffa6adc8
export SURFACE0=0xff313244
export SURFACE1=0xff45475a
export OVERLAY0=0xff6c7086
export LAVENDER=0xffb4befe
export MAUVE=0xffcba6f7
export BLUE=0xff89b4fa
export GREEN=0xffa6e3a1
export YELLOW=0xfff9e2af
export ORANGE=0xfffab387
export RED=0xfff38ba8

# ===== FONTS & STYLING =====
FONT_FACE="JetBrainsMono Nerd Font"
PLUGIN_DIR="$HOME/.config/sketchybar/plugins"

# ===== BAR SETUP (TRANSPARENT BACKGROUND) =====
sketchybar --bar \
    height=36 \
    color=0x00000000 \
    shadow=off \
    position=top \
    sticky=on \
    padding_right=15 \
    padding_left=15 \
    corner_radius=0 \
    y_offset=8 \
    margin=12 \
    blur_radius=0 \
    notch_width=200

# ===== DEFAULT STYLING =====
sketchybar --default \
    updates=when_shown \
    icon.font="$FONT_FACE:Bold:15.0" \
    icon.color=$TEXT \
    icon.padding_left=6 \
    icon.padding_right=6 \
    label.font="$FONT_FACE:Medium:13.0" \
    label.color=$TEXT \
    label.padding_left=4 \
    label.padding_right=6 \
    padding_right=4 \
    padding_left=4 \
    background.height=28 \
    background.corner_radius=8

# ===== LEFT SIDE CONTAINER =====
sketchybar --add bracket left_container \
           --set left_container \
                 background.color=$SURFACE0 \
                 background.corner_radius=12 \
                 background.height=32 \
                 background.border_width=1 \
                 background.border_color=$SURFACE1

# Apple logo with system menu
sketchybar --add item apple_logo left \
           --set apple_logo \
                 icon="" \
                 icon.font="SF Pro:Black:16.0" \
                 icon.color=$TEXT \
                 label.drawing=off \
                 padding_left=12 \
                 padding_right=8 \
                 script="$PLUGIN_DIR/apple_menu.sh" \
                 click_script="$PLUGIN_DIR/apple_menu.sh"

# First separator
sketchybar --add item left_sep1 left \
           --set left_sep1 \
                 icon="│" \
                 icon.color=$OVERLAY0 \
                 icon.font="$FONT_FACE:Regular:14.0" \
                 label.drawing=off \
                 padding_left=4 \
                 padding_right=4

# AeroSpace workspaces
WORKSPACES=(u i o p)
for ws in "${WORKSPACES[@]}"; do
    sketchybar --add item space.$ws left \
               --set space.$ws \
                     label="$ws" \
                     label.font="$FONT_FACE:Bold:14.0" \
                     icon.drawing=off \
                     background.drawing=off \
                     label.color=$SUBTEXT \
                     padding_left=8 \
                     padding_right=8 \
                     updates=off \
                     click_script="aerospace workspace $ws"
done

# Second separator
sketchybar --add item left_sep2 left \
           --set left_sep2 \
                 icon="│" \
                 icon.color=$OVERLAY0 \
                 icon.font="$FONT_FACE:Regular:14.0" \
                 label.drawing=off \
                 padding_left=4 \
                 padding_right=4

# Current application
sketchybar --add item front_app left \
           --set front_app \
                 icon="󰣇" \
                 icon.font="$FONT_FACE:Bold:16.0" \
                 icon.color=$BLUE \
                 label.max_chars=25 \
                 label.color=$TEXT \
                 label.font="$FONT_FACE:Bold:13.0" \
                 padding_left=8 \
                 padding_right=12 \
                 script="$PLUGIN_DIR/front_app.sh" \
           --subscribe front_app front_app_switched

# Add items to left container
sketchybar --set left_container \
           --add bracket left_container \
                         apple_logo \
                         left_sep1 \
                         space.u \
                         space.i \
                         space.o \
                         space.p \
                         left_sep2 \
                         front_app

# ===== CENTER - SPOTIFY CONTAINER =====
sketchybar --add item spotify center \
           --set spotify \
                 icon="󰓇" \
                 icon.font="$FONT_FACE:Bold:18.0" \
                 icon.color=$GREEN \
                 label="No music playing" \
                 label.max_chars=50 \
                 label.color=$TEXT \
                 label.font="$FONT_FACE:Medium:13.0" \
                 padding_left=12 \
                 padding_right=12 \
                 background.color=$SURFACE0 \
                 background.corner_radius=12 \
                 background.height=32 \
                 background.border_width=1 \
                 background.border_color=$SURFACE1 \
                 background.drawing=on \
                 script="$PLUGIN_DIR/spotify.sh" \
                 update_freq=2 \
                 click_script="$PLUGIN_DIR/spotify.sh" \
           --subscribe spotify media_change

# ===== RIGHT SIDE CONTAINERS =====

# Clock container
sketchybar --add item clock right \
           --set clock \
                 icon="󰥔" \
                 icon.font="$FONT_FACE:Bold:15.0" \
                 icon.color=$LAVENDER \
                 label.color=$TEXT \
                 label.font="$FONT_FACE:Bold:13.0" \
                 padding_left=12 \
                 padding_right=12 \
                 background.color=$SURFACE0 \
                 background.corner_radius=6 \
                 background.height=30 \
                 background.border_width=1 \
                 background.border_color=$SURFACE1 \
                 background.drawing=on \
                 script="$PLUGIN_DIR/clock.sh" \
                 update_freq=10

# Battery container
sketchybar --add item battery right \
           --set battery \
                 icon.font="$FONT_FACE:Bold:15.0" \
                 icon.color=$GREEN \
                 label.color=$TEXT \
                 label.font="$FONT_FACE:Bold:13.0" \
                 padding_left=12 \
                 padding_right=12 \
                 background.color=$SURFACE0 \
                 background.corner_radius=6 \
                 background.height=30 \
                 background.border_width=1 \
                 background.border_color=$SURFACE1 \
                 background.drawing=on \
                 script="$PLUGIN_DIR/battery.sh" \
                 update_freq=120 \
           --subscribe battery power_source_change system_woke

# Volume container
sketchybar --add item volume right \
           --set volume \
                 icon.font="$FONT_FACE:Bold:15.0" \
                 icon.color=$BLUE \
                 label.color=$TEXT \
                 label.font="$FONT_FACE:Bold:13.0" \
                 padding_left=12 \
                 padding_right=12 \
                 background.color=$SURFACE0 \
                 background.corner_radius=6 \
                 background.height=30 \
                 background.border_width=1 \
                 background.border_color=$SURFACE1 \
                 background.drawing=on \
                 script="$PLUGIN_DIR/volume.sh" \
           --subscribe volume volume_change

# ===== AEROSPACE INTEGRATION =====
sketchybar --add event aerospace_workspace_change

# Subscribe workspaces to aerospace changes
for ws in "${WORKSPACES[@]}"; do
    sketchybar --subscribe space.$ws aerospace_workspace_change
done

sketchybar --add item aerospace_listener left \
           --set aerospace_listener \
                 script="$PLUGIN_DIR/aerospace.sh" \
                 label.drawing=off \
                 icon.drawing=off \
                 width=0 \
           --subscribe aerospace_listener aerospace_workspace_change

# ===== FINALIZATION =====
sketchybar --update
